Public Sub JYYL(a As Integer, b As Integer, c As Integer, d As Integer, e As Integer, S1 As String, S2 As String, S3 As String, S4 As String, S5 As String, S6 As String, S8 As String, _
S9 As String, S10 As String, S11 As String, S18 As String, S19 As String, S20 As String, S22 As String, S23 As String, GJ As String, S24 As String, S25 As String)
    'AE值为1设为开始更新标志
    If Application.Cells(1, 31) = "1" Then
        Dim Er As String
        '遍历整张表
        Dim i As Integer
        For i = 2 To a
            '清货/退货费用/清货调整
            If Application.Cells(i, 3) = S10 Or Application.Cells(i, 3) = S19 Or Application.Cells(i, 3) = S11 Then
                If Application.WorksheetFunction.IsError(Application.Match(Application.Cells(i, 5), Application.Sheets("FNSKU对应SKU").Range("A2:A" & b), 0)) = False Then
                    '匹配清货/退货商品SKU
                    Application.Cells(i, 31) = Application.VLookup(Application.Cells(i, 5), Application.Sheets("FNSKU对应SKU").Range("A2:B" & b), 2, False)
                Else
                    Application.Cells(i, 31) = "未匹配到"
                    '提示有退货或者清货商品未匹配到
                    Er = Er & "，有退货或者清货商品未匹配到"
                End If
                
            'FBA库存赔偿
            ElseIf Application.Cells(i, 3) = S18 Then
                If Application.Cells(i, 6) = S1 Or Application.Cells(i, 6) = S2 Or Application.Cells(i, 6) = S3 Or Application.Cells(i, 6) = S4 Or _
                Application.Cells(i, 6) = S20 Or Application.Cells(i, 6) = S22 Or Application.Cells(i, 6) = S23 Then
                    If Application.WorksheetFunction.IsError(Application.Match(Application.Cells(i, 5), Application.Sheets("FBA商品成本").Range("A2:A" & c), 0)) = False _
                    And Left(Application.Cells(i, 4), 1) <> "S" Then
                        'FBA库存赔偿的采购成本
                        Application.Cells(i, 32) = -Format(Application.VLookup(Application.Cells(i, 5), Application.Sheets("FBA商品成本").Range("A2:D" & c), 4, False) * Application.Cells(i, 7), "0.00")
                        'FBA库存赔偿的头程成本
                        Application.Cells(i, 33) = -Format(Application.VLookup(Application.Cells(i, 5), Application.Sheets("FBA商品成本").Range("A2:E" & c), 5, False) * Application.Cells(i, 7), "0.00")
                    ElseIf Left(Application.Cells(i, 4), 1) = "S" Then
                        Application.Cells(i, 32) = "清货丢失赔偿"
                        Application.Cells(i, 33) = "清货丢失赔偿"
                    Else
                        Application.Cells(i, 32) = "未匹配到"
                        Application.Cells(i, 33) = "未匹配到"
                        
                        '提示有库存赔偿商品未匹配到
                        Er = Er & "，有库存赔偿商品未匹配到"
                    End If
                    
                    'FBA库存赔偿合计
                    Dim KCPC As Single
                    If GJ = "US" Then
                        KCPC = KCPC + Application.Cells(i, 29)
                    ElseIf GJ = "CA" Then
                        KCPC = KCPC + Application.Cells(i, 29)
                    ElseIf GJ = "JP" Then
                        KCPC = KCPC + Application.Cells(i, 28)
                    ElseIf GJ = "DE" Or GJ = "FR" Or GJ = "ES" Or GJ = "IT" Then
                        KCPC = KCPC + Application.Cells(i, 27)
                    End If
                    
                'FBA库存赔偿退款
                ElseIf Application.Cells(i, 6) = S5 Then
                    If Application.WorksheetFunction.IsError(Application.Match(Application.Cells(i, 5), Application.Sheets("FBA商品成本").Range("A2:A" & c), 0)) = False Then
                        'FBA库存赔偿退款的采购成本
                        Application.Cells(i, 32) = Format(Application.VLookup(Application.Cells(i, 5), Application.Sheets("FBA商品成本").Range("A2:D" & c), 4, False) * Application.Cells(i, 7), "0.00")
                        'FBA库存赔偿退款的头程成本
                        Application.Cells(i, 33) = Format(Application.VLookup(Application.Cells(i, 5), Application.Sheets("FBA商品成本").Range("A2:E" & c), 5, False) * Application.Cells(i, 7), "0.00")
                    Else
                        Application.Cells(i, 32) = "未匹配到"
                        Application.Cells(i, 33) = "未匹配到"
                        Er = Er & "，有库存赔偿商品未匹配到"
                    End If
                    
                    'FBA库存赔偿退款合计
                    Dim KCPCTK As Single
                    If GJ = "US" Then
                        KCPCTK = KCPCTK + Application.Cells(i, 29)
                    ElseIf GJ = "CA" Then
                        KCPCTK = KCPCTK + Application.Cells(i, 29)
                    ElseIf GJ = "JP" Then
                        KCPCTK = KCPCTK + Application.Cells(i, 28)
                    ElseIf GJ = "DE" Or GJ = "FR" Or GJ = "ES" Or GJ = "IT" Then
                        KCPCTK = KCPCTK + Application.Cells(i, 27)
                    End If
                End If
                 
                '提示有库存赔偿采购为0
                If Application.Cells(i, 32) = 0 Then
                    Er = Er & "，有库存赔偿商品采购为0"
                End If
                
                '提示有库存赔偿运费为0
                If Application.Cells(i, 33) = 0 Then
                    Er = Er & "，有库存赔偿商品运费为0"
                End If
                
            '检查ERP导出订单是否完整
            ElseIf Application.Cells(i, 3) = S6 Or Application.Cells(i, 3) = S24 Then
                If GJ = "US" Then
                    'FBA订单
                    If Application.Cells(i, 10) = S8 Then
                        Application.Cells(i, 34) = Application.Cells(i, 4) & "|" & Application.Cells(i, 5)
                        Application.Cells(i, 35) = Application.Cells(i, 34) & "|" & Application.SumIfs(Application.Sheets("交易一览").Range("G2:G" & a), _
                        Application.Sheets("交易一览").Range("AH2:AH" & a), Application.Cells(i, 34))
                        Application.Cells(i, 36) = Application.IsNumber(Application.Match(Application.Cells(i, 35), Application.Sheets("ERP导出FBA数据").Range("J2:J" & d), 0))
                    'FBM订单
                    ElseIf Application.Cells(i, 10) = S9 Then
                        Application.Cells(i, 35) = Application.Cells(i, 4) & "|" & Application.SumIfs(Application.Sheets("交易一览").Range("G2:G" & a), _
                        Application.Sheets("交易一览").Range("C2:C" & a), S6, Application.Sheets("交易一览").Range("D2:D" & a), Application.Cells(i, 4))
                        Application.Cells(i, 36) = Application.IsNumber(Application.Match(Application.Cells(i, 35), Application.Sheets("ERP导出FBM数据").Range("K2:K" & e), 0))
                    
                    End If
                ElseIf GJ = "DE" Or GJ = "JP" Or GJ = "CA" Or GJ = "FR" Or GJ = "ES" Or GJ = "IT" Then
                    'FBA订单
                    If Application.Cells(i, 9) = S8 Then
                        Application.Cells(i, 34) = Application.Cells(i, 4) & "|" & Application.Cells(i, 5)
                        Application.Cells(i, 35) = Application.Cells(i, 34) & "|" & Application.SumIfs(Application.Sheets("交易一览").Range("G2:G" & a), _
                        Application.Sheets("交易一览").Range("AH2:AH" & a), Application.Cells(i, 34))
                        Application.Cells(i, 36) = Application.IsNumber(Application.Match(Application.Cells(i, 35), Application.Sheets("ERP导出FBA数据").Range("J2:J" & d), 0))
                    'FBM订单
                    ElseIf Application.Cells(i, 9) = S9 Then
                        Application.Cells(i, 35) = Application.Cells(i, 4) & "|" & Application.SumIfs(Application.Sheets("交易一览").Range("G2:G" & a), _
                        Application.Sheets("交易一览").Range("C2:C" & a), S6, Application.Sheets("交易一览").Range("D2:D" & a), Application.Cells(i, 4))
                        Application.Cells(i, 36) = Application.IsNumber(Application.Match(Application.Cells(i, 35), Application.Sheets("ERP导出FBM数据").Range("K2:K" & e), 0))
                    End If
                End If
            ElseIf Application.Cells(i, 3) = S25 Then
                '匹配费用调整SKU
                Application.Cells(i, 31) = Application.VLookup(Application.Cells(i, 4), Application.Sheets("交易一览").Range("D2:E" & a), 2, False)
            End If
        Next
        
        '汇总库存赔偿和库存赔偿退款
        Application.Cells(1, 34) = Format(KCPC, "0.00")
        Application.Cells(1, 35) = Format(KCPCTK, "0.00")
        
        '停止更新
        MsgBox "更新完毕" & Er & Chr(10) & Chr(10) & "库存赔偿差额" & Format(KCPC - Application.Sheets("汇总").Range("F2"), "0.00") & Chr(10) & "库存赔偿退款差额" & Format(KCPCTK - Application.Sheets("汇总").Range("Q2"), "0.00")
        Application.Cells(1, 31) = "0"
    End If
End SubPublic Sub JYYL(a As Integer, b As Integer, c As Integer, d As Integer, e As Integer, S1 As String, S2 As String, S3 As String, S4 As String, S5 As String, S6 As String, S8 As String, _
S9 As String, S10 As String, S11 As String, S18 As String, S19 As String, S20 As String, S22 As String, S23 As String, GJ As String, S24 As String, S25 As String)
    'AE值为1设为开始更新标志
    If Application.Cells(1, 31) = "1" Then
        Dim Er As String
        '遍历整张表
        Dim i As Integer
        For i = 2 To a
            '清货/退货费用/清货调整
            If Application.Cells(i, 3) = S10 Or Application.Cells(i, 3) = S19 Or Application.Cells(i, 3) = S11 Then
                If Application.WorksheetFunction.IsError(Application.Match(Application.Cells(i, 5), Application.Sheets("FNSKU对应SKU").Range("A2:A" & b), 0)) = False Then
                    '匹配清货/退货商品SKU
                    Application.Cells(i, 31) = Application.VLookup(Application.Cells(i, 5), Application.Sheets("FNSKU对应SKU").Range("A2:B" & b), 2, False)
                Else
                    Application.Cells(i, 31) = "未匹配到"
                    '提示有退货或者清货商品未匹配到
                    Er = Er & "，有退货或者清货商品未匹配到"
                End If
                
            'FBA库存赔偿
            ElseIf Application.Cells(i, 3) = S18 Then
                If Application.Cells(i, 6) = S1 Or Application.Cells(i, 6) = S2 Or Application.Cells(i, 6) = S3 Or Application.Cells(i, 6) = S4 Or _
                Application.Cells(i, 6) = S20 Or Application.Cells(i, 6) = S22 Or Application.Cells(i, 6) = S23 Then
                    If Application.WorksheetFunction.IsError(Application.Match(Application.Cells(i, 5), Application.Sheets("FBA商品成本").Range("A2:A" & c), 0)) = False _
                    And Left(Application.Cells(i, 4), 1) <> "S" Then
                        'FBA库存赔偿的采购成本
                        Application.Cells(i, 32) = -Format(Application.VLookup(Application.Cells(i, 5), Application.Sheets("FBA商品成本").Range("A2:D" & c), 4, False) * Application.Cells(i, 7), "0.00")
                        'FBA库存赔偿的头程成本
                        Application.Cells(i, 33) = -Format(Application.VLookup(Application.Cells(i, 5), Application.Sheets("FBA商品成本").Range("A2:E" & c), 5, False) * Application.Cells(i, 7), "0.00")
                    ElseIf Left(Application.Cells(i, 4), 1) = "S" Then
                        Application.Cells(i, 32) = "清货丢失赔偿"
                        Application.Cells(i, 33) = "清货丢失赔偿"
                    Else
                        Application.Cells(i, 32) = "未匹配到"
                        Application.Cells(i, 33) = "未匹配到"
                        
                        '提示有库存赔偿商品未匹配到
                        Er = Er & "，有库存赔偿商品未匹配到"
                    End If
                    
                    'FBA库存赔偿合计
                    Dim KCPC As Single
                    If GJ = "US" Then
                        KCPC = KCPC + Application.Cells(i, 29)
                    ElseIf GJ = "CA" Then
                        KCPC = KCPC + Application.Cells(i, 29)
                    ElseIf GJ = "JP" Then
                        KCPC = KCPC + Application.Cells(i, 28)
                    ElseIf GJ = "DE" Or GJ = "FR" Or GJ = "ES" Or GJ = "IT" Then
                        KCPC = KCPC + Application.Cells(i, 27)
                    End If
                    
                'FBA库存赔偿退款
                ElseIf Application.Cells(i, 6) = S5 Then
                    If Application.WorksheetFunction.IsError(Application.Match(Application.Cells(i, 5), Application.Sheets("FBA商品成本").Range("A2:A" & c), 0)) = False Then
                        'FBA库存赔偿退款的采购成本
                        Application.Cells(i, 32) = Format(Application.VLookup(Application.Cells(i, 5), Application.Sheets("FBA商品成本").Range("A2:D" & c), 4, False) * Application.Cells(i, 7), "0.00")
                        'FBA库存赔偿退款的头程成本
                        Application.Cells(i, 33) = Format(Application.VLookup(Application.Cells(i, 5), Application.Sheets("FBA商品成本").Range("A2:E" & c), 5, False) * Application.Cells(i, 7), "0.00")
                    Else
                        Application.Cells(i, 32) = "未匹配到"
                        Application.Cells(i, 33) = "未匹配到"
                        Er = Er & "，有库存赔偿商品未匹配到"
                    End If
                    
                    'FBA库存赔偿退款合计
                    Dim KCPCTK As Single
                    If GJ = "US" Then
                        KCPCTK = KCPCTK + Application.Cells(i, 29)
                    ElseIf GJ = "CA" Then
                        KCPCTK = KCPCTK + Application.Cells(i, 29)
                    ElseIf GJ = "JP" Then
                        KCPCTK = KCPCTK + Application.Cells(i, 28)
                    ElseIf GJ = "DE" Or GJ = "FR" Or GJ = "ES" Or GJ = "IT" Then
                        KCPCTK = KCPCTK + Application.Cells(i, 27)
                    End If
                End If
                 
                '提示有库存赔偿采购为0
                If Application.Cells(i, 32) = 0 Then
                    Er = Er & "，有库存赔偿商品采购为0"
                End If
                
                '提示有库存赔偿运费为0
                If Application.Cells(i, 33) = 0 Then
                    Er = Er & "，有库存赔偿商品运费为0"
                End If
                
            '检查ERP导出订单是否完整
            ElseIf Application.Cells(i, 3) = S6 Or Application.Cells(i, 3) = S24 Then
                If GJ = "US" Then
                    'FBA订单
                    If Application.Cells(i, 10) = S8 Then
                        Application.Cells(i, 34) = Application.Cells(i, 4) & "|" & Application.Cells(i, 5)
                        Application.Cells(i, 35) = Application.Cells(i, 34) & "|" & Application.SumIfs(Application.Sheets("交易一览").Range("G2:G" & a), _
                        Application.Sheets("交易一览").Range("AH2:AH" & a), Application.Cells(i, 34))
                        Application.Cells(i, 36) = Application.IsNumber(Application.Match(Application.Cells(i, 35), Application.Sheets("ERP导出FBA数据").Range("J2:J" & d), 0))
                    'FBM订单
                    ElseIf Application.Cells(i, 10) = S9 Then
                        Application.Cells(i, 35) = Application.Cells(i, 4) & "|" & Application.SumIfs(Application.Sheets("交易一览").Range("G2:G" & a), _
                        Application.Sheets("交易一览").Range("C2:C" & a), S6, Application.Sheets("交易一览").Range("D2:D" & a), Application.Cells(i, 4))
                        Application.Cells(i, 36) = Application.IsNumber(Application.Match(Application.Cells(i, 35), Application.Sheets("ERP导出FBM数据").Range("K2:K" & e), 0))
                    
                    End If
                ElseIf GJ = "DE" Or GJ = "JP" Or GJ = "CA" Or GJ = "FR" Or GJ = "ES" Or GJ = "IT" Then
                    'FBA订单
                    If Application.Cells(i, 9) = S8 Then
                        Application.Cells(i, 34) = Application.Cells(i, 4) & "|" & Application.Cells(i, 5)
                        Application.Cells(i, 35) = Application.Cells(i, 34) & "|" & Application.SumIfs(Application.Sheets("交易一览").Range("G2:G" & a), _
                        Application.Sheets("交易一览").Range("AH2:AH" & a), Application.Cells(i, 34))
                        Application.Cells(i, 36) = Application.IsNumber(Application.Match(Application.Cells(i, 35), Application.Sheets("ERP导出FBA数据").Range("J2:J" & d), 0))
                    'FBM订单
                    ElseIf Application.Cells(i, 9) = S9 Then
                        Application.Cells(i, 35) = Application.Cells(i, 4) & "|" & Application.SumIfs(Application.Sheets("交易一览").Range("G2:G" & a), _
                        Application.Sheets("交易一览").Range("C2:C" & a), S6, Application.Sheets("交易一览").Range("D2:D" & a), Application.Cells(i, 4))
                        Application.Cells(i, 36) = Application.IsNumber(Application.Match(Application.Cells(i, 35), Application.Sheets("ERP导出FBM数据").Range("K2:K" & e), 0))
                    End If
                End If
            ElseIf Application.Cells(i, 3) = S25 Then
                '匹配费用调整SKU
                Application.Cells(i, 31) = Application.VLookup(Application.Cells(i, 4), Application.Sheets("交易一览").Range("D2:E" & a), 2, False)
            End If
        Next
        
        '汇总库存赔偿和库存赔偿退款
        Application.Cells(1, 34) = Format(KCPC, "0.00")
        Application.Cells(1, 35) = Format(KCPCTK, "0.00")
        
        '停止更新
        MsgBox "更新完毕" & Er & Chr(10) & Chr(10) & "库存赔偿差额" & Format(KCPC - Application.Sheets("汇总").Range("F2"), "0.00") & Chr(10) & "库存赔偿退款差额" & Format(KCPCTK - Application.Sheets("汇总").Range("Q2"), "0.00")
        Application.Cells(1, 31) = "0"
    End If
End Sub
